<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stakehood Admin Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --secondary: #0ea5e9;
      --accent: #8b5cf6;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg-dark: #0f172a;
      --bg-card: #1e293b;
      --bg-card-hover: #273549;
      --bg-light: #334155;
      --text: #f8fafc;
      --text-muted: #94a3b8;
      --border: #334155;
      --header-height: 70px;
      --sidebar-width: 280px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
    }
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--bg-card);
      height: 100vh;
      overflow-y: auto;
      position: fixed;
      left: 0;
      top: 0;
      border-right: 1px solid var(--border);
      z-index: 10;
    }
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 18px;
      color: var(--primary);
    }
    .brand i {
      font-size: 24px;
    }
    .mobile-toggle {
      display: none;
      font-size: 20px;
      color: var(--text-muted);
      background: none;
      border: none;
      cursor: pointer;
    }
    .menu-section {
      margin-top: 20px;
    }
    .menu-title {
      padding: 0 20px;
      font-size: 12px;
      text-transform: uppercase;
      color: var(--text-muted);
      letter-spacing: 1px;
      margin-bottom: 10px;
    }
    .menu-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text);
      text-decoration: none;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }
    .menu-item:hover {
      background-color: var(--bg-light);
    }
    .menu-item.active {
      background-color: rgba(99, 102, 241, 0.1);
      color: var(--primary);
      border-left-color: var(--primary);
    }
    .menu-item i {
      font-size: 18px;
      color: var(--text-muted);
      transition: color 0.2s;
    }
    .menu-item.active i {
      color: var(--primary);
    }
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 20px;
    }
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .page-title {
      font-size: 24px;
      font-weight: 600;
    }
    .admin-actions {
      display: flex;
      gap: 12px;
    }
    .admin-key-input {
      padding: 8px 16px;
      border-radius: 6px;
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 14px;
    }
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }
    .stat-card {
      background-color: var(--bg-card);
      border-radius: 8px;
      padding: 20px;
      border: 1px solid var(--border);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      font-size: 24px;
    }
    .stat-value {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .stat-label {
      color: var(--text-muted);
      font-size: 14px;
    }
    .bg-primary {
      background-color: rgba(99, 102, 241, 0.15);
      color: var(--primary);
    }
    .bg-secondary {
      background-color: rgba(14, 165, 233, 0.15);
      color: var(--secondary);
    }
    .bg-success {
      background-color: rgba(16, 185, 129, 0.15);
      color: var(--success);
    }
    .bg-warning {
      background-color: rgba(245, 158, 11, 0.15);
      color: var(--warning);
    }
    .bg-danger {
      background-color: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }
    .bg-accent {
      background-color: rgba(139, 92, 246, 0.15);
      color: var(--accent);
    }
    .card {
      background-color: var(--bg-card);
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-bottom: 24px;
      overflow: hidden;
    }
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .card-title {
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card-body {
      padding: 20px;
    }
    .card-actions {
      display: flex;
      gap: 8px;
    }
    .empty-state {
      padding: 40px 20px;
      text-align: center;
    }
    .empty-state i {
      font-size: 48px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }
    .empty-state-message {
      margin-bottom: 20px;
      color: var(--text-muted);
    }
    .table-container {
      overflow-x: auto;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }
    .admin-table th,
    .admin-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .admin-table th {
      font-weight: 500;
      color: var(--text-muted);
      font-size: 13px;
    }
    .admin-table tbody tr {
      transition: background-color 0.2s;
    }
    .admin-table tbody tr:hover {
      background-color: var(--bg-card-hover);
    }
    .table-actions {
      display: flex;
      gap: 8px;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      outline: none;
    }
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    .btn-primary:hover {
      background-color: var(--primary-dark);
    }
    .btn-secondary {
      background-color: var(--secondary);
      color: white;
    }
    .btn-secondary:hover {
      background-color: #0284c7;
    }
    .btn-success {
      background-color: var(--success);
      color: white;
    }
    .btn-success:hover {
      background-color: #059669;
    }
    .btn-danger {
      background-color: var(--danger);
      color: white;
    }
    .btn-danger:hover {
      background-color: #dc2626;
    }
    .btn-warning {
      background-color: var(--warning);
      color: white;
    }
    .btn-warning:hover {
      background-color: #d97706;
    }
    .btn-outline {
      background-color: transparent;
      border: 1.5px solid var(--border);
      color: var(--text);
    }
    .btn-outline:hover {
      border-color: var(--text-muted);
    }
    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
    }
    .btn-icon {
      padding: 8px;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(15, 23, 42, 0.9);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    .modal-container {
      background-color: var(--bg-card);
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(20px);
      transition: transform 0.2s ease;
    }
    .modal-overlay.active .modal-container {
      transform: translateY(0);
    }
    .modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title {
      font-weight: 600;
      font-size: 18px;
    }
    .modal-close {
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 24px;
      cursor: pointer;
    }
    .modal-body {
      padding: 20px;
    }
    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
    }
    .form-control {
      width: 100%;
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: var(--bg-light);
      color: var(--text);
      font-size: 14px;
      transition: border-color 0.2s;
    }
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
    }
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .tab {
      padding: 12px 20px;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 24px;
      gap: 8px;
    }
    .pagination-item {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
      padding: 0 8px;
      border-radius: 6px;
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }
    .pagination-item:hover {
      background-color: var(--bg-light);
    }
    .pagination-item.active {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 16px 20px;
      border-radius: 8px;
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 12px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .notification-content {
      flex: 1;
    }
    .notification-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .notification-message {
      font-size: 14px;
      color: var(--text-muted);
    }
    .loading {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--text);
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(15, 23, 42, 0.7);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 16px;
    }
    .loading-overlay .loading {
      width: 48px;
      height: 48px;
    }
    .loading-text {
      color: var(--text);
    }
    .user-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }
    .user-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: 600;
    }
    .user-info {
      flex: 1;
    }
    .user-name {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .user-meta {
      color: var(--text-muted);
      margin-bottom: 12px;
    }
    .inventory-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }
    .inventory-item:last-child {
      border-bottom: none;
    }
    .skin-image {
      width: 48px;
      height: 48px;
      border-radius: 6px;
      object-fit: cover;
      background-color: var(--bg-light);
    }
    .skin-info {
      flex: 1;
    }
    .skin-name {
      font-weight: 500;
      margin-bottom: 4px;
    }
    .skin-value {
      font-size: 13px;
      color: var(--text-muted);
    }
    .skin-rarity {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    .skin-count {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background-color: var(--bg-light);
      font-size: 13px;
      font-weight: 500;
    }
    @media (max-width: 1024px) {
      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-280px);
        transition: transform 0.3s ease;
      }
      .sidebar.active {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
      }
      .mobile-toggle {
        display: block;
      }
    }
    @media (max-width: 576px) {
      .stats-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="brand">
        <i class="fas fa-shield-alt"></i>
        <span>Stakehood Admin</span>
      </div>
      <button class="mobile-toggle" id="sidebarClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="menu-section">
      <div class="menu-title">Dashboard</div>
      <a href="#dashboard" class="menu-item active" data-page="dashboard">
        <i class="fas fa-chart-line"></i>
        <span>Overview</span>
      </a>
      <a href="#users" class="menu-item" data-page="users">
        <i class="fas fa-users"></i>
        <span>Users</span>
      </a>
      <a href="#games" class="menu-item" data-page="games">
        <i class="fas fa-gamepad"></i>
        <span>Games</span>
      </a>
      <a href="#skins" class="menu-item" data-page="skins">
        <i class="fas fa-palette"></i>
        <span>Skins</span>
      </a>
    </div>
    <div class="menu-section">
      <div class="menu-title">Management</div>
      <a href="#add-skins" class="menu-item" data-page="add-skins">
        <i class="fas fa-plus-circle"></i>
        <span>Add Skins</span>
      </a>
      <a href="#give-skins" class="menu-item" data-page="give-skins">
        <i class="fas fa-gift"></i>
        <span>Give Skins</span>
      </a>
      <a href="#logs" class="menu-item" data-page="logs">
        <i class="fas fa-file-alt"></i>
        <span>Logs</span>
      </a>
    </div>
  </div>

  <div class="main-content" id="mainContent">
    <div class="dashboard-header">
      <h1 class="page-title" id="pageTitle">Dashboard Overview</h1>
      <div class="admin-actions">
        <input type="password" id="adminKey" placeholder="Admin Key" class="admin-key-input">
        <button id="mobileMenuToggle" class="btn btn-outline btn-icon d-md-none">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </div>

    <div class="page active" id="dashboardPage">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon bg-primary">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-value" id="totalUsers">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon bg-secondary">
            <i class="fas fa-gamepad"></i>
          </div>
          <div class="stat-value" id="totalGames">0</div>
          <div class="stat-label">Total Games</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon bg-success">
            <i class="fas fa-box-open"></i>
          </div>
          <div class="stat-value" id="totalSkins">0</div>
          <div class="stat-label">Inventory Items</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon bg-warning">
            <i class="fas fa-coins"></i>
          </div>
          <div class="stat-value" id="totalValue">0</div>
          <div class="stat-label">Total Value Locked</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-server text-secondary"></i>
            Server Status
          </div>
          <div class="card-actions">
            <button class="btn btn-outline btn-sm" id="refreshServerStatus">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="stats-row">
            <div class="stat-card">
              <div class="stat-icon bg-primary">
                <i class="fas fa-play-circle"></i>
              </div>
              <div class="stat-value" id="activeGames">0</div>
              <div class="stat-label">Active Games</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon bg-warning">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-value" id="pendingApprovals">0</div>
              <div class="stat-label">Pending Approvals</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon bg-success">
                <i class="fas fa-user-check"></i>
              </div>
              <div class="stat-value" id="activeSessions">0</div>
              <div class="stat-label">Active Sessions</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon bg-accent">
                <i class="fas fa-user-plus"></i>
              </div>
              <div class="stat-value" id="newRegistrations">0</div>
              <div class="stat-label">New Users (24h)</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-exchange-alt text-success"></i>
            Recent Games
          </div>
          <div class="card-actions">
            <a href="#games" class="btn btn-outline btn-sm" data-page="games">
              View All
            </a>
          </div>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="admin-table" id="recentGamesTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Creator</th>
                  <th>Joiner</th>
                  <th>Status</th>
                  <th>Value</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="recentGamesBody">
                <tr>
                  <td colspan="7" class="text-center">Loading games...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="page" id="usersPage">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-users text-primary"></i>
            User Management
          </div>
          <div class="card-actions">
            <div class="search-container">
              <input type="text" id="userSearch" placeholder="Search users..." class="form-control">
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="admin-table" id="usersTable">
              <thead>
                <tr>
                  <th>Discord ID</th>
                  <th>Roblox Username</th>
                  <th>Registered</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr>
                  <td colspan="4" class="text-center">Loading users...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="pagination" id="usersPagination"></div>
        </div>
      </div>
    </div>
    
    <div class="page" id="userDetailsPage">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-user text-primary"></i>
            User Details
          </div>
          <div class="card-actions">
            <button class="btn btn-outline btn-sm" id="backToUsers">
              <i class="fas fa-arrow-left"></i> Back to Users
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="user-header">
            <div class="user-avatar" id="userAvatar">U</div>
            <div class="user-info">
              <h2 class="user-name" id="userDetailName">Username</h2>
              <div class="user-meta">
                Discord ID: <span id="userDiscordId">000000000000000000</span> | Registered: <span id="userRegisteredAt">2023-01-01</span>
              </div>
              <div class="user-actions">
                <button class="btn btn-primary btn-sm" id="addSkinsToUser">
                  <i class="fas fa-plus"></i> Give Skins
                </button>
                <button class="btn btn-warning btn-sm" id="clearUserNotifications">
                  <i class="fas fa-bell-slash"></i> Clear Notifications
                </button>
              </div>
            </div>
          </div>
          
          <div class="tabs">
            <div class="tab active" data-tab="inventory">Inventory</div>
            <div class="tab" data-tab="games">Game History</div>
            <div class="tab" data-tab="stats">Stats</div>
          </div>
          
          <div class="tab-content active" data-tab-content="inventory">
            <div class="inventory-container" id="userInventory">
              <div class="empty-state">
                <i class="fas fa-box-open"></i>
                <h3>No items in inventory</h3>
                <p class="empty-state-message">This user doesn't have any skins in their inventory.</p>
              </div>
            </div>
          </div>
          
          <div class="tab-content" data-tab-content="games">
            <div class="table-container">
              <table class="admin-table" id="userGamesTable">
                <thead>
                  <tr>
                    <th>Game ID</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Result</th>
                    <th>Value</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="userGamesBody">
                  <tr>
                    <td colspan="6" class="text-center">Loading games...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="tab-content" data-tab-content="stats">
            <div class="stats-row">
              <div class="stat-card">
                <div class="stat-icon bg-primary">
                  <i class="fas fa-gamepad"></i>
                </div>
                <div class="stat-value" id="userTotalGames">0</div>
                <div class="stat-label">Total Games</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon bg-success">
                  <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-value" id="userWins">0</div>
                <div class="stat-label">Games Won</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon bg-danger">
                  <i class="fas fa-times"></i>
                </div>
                <div class="stat-value" id="userLosses">0</div>
                <div class="stat-label">Games Lost</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon bg-warning">
                  <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-value" id="userWinRate">0%</div>
                <div class="stat-label">Win Rate</div>
              </div>
            </div>
            
            <div class="stats-row">
              <div class="stat-card">
                <div class="stat-icon bg-secondary">
                  <i class="fas fa-plus"></i>
                </div>
                <div class="stat-value" id="userGamesCreated">0</div>
                <div class="stat-label">Games Created</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon bg-secondary">
                  <i class="fas fa-sign-in-alt"></i>
                </div>
                <div class="stat-value" id="userGamesJoined">0</div>
                <div class="stat-label">Games Joined</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon bg-accent">
                  <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-value" id="userGamesCancelled">0</div>
                <div class="stat-label">Games Cancelled</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon bg-primary">
                  <i class="fas fa-box"></i>
                </div>
                <div class="stat-value" id="userInventoryValue">0</div>
                <div class="stat-label">Inventory Value</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="page" id="gamesPage">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-gamepad text-secondary"></i>
            Games
          </div>
          <div class="card-actions">
            <button class="btn btn-outline btn-sm" id="refreshGames">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="admin-table" id="gamesTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Creator</th>
                  <th>Joiner</th>
                  <th>Status</th>
                  <th>Value</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="gamesTableBody">
                <tr>
                  <td colspan="7" class="text-center">Loading games...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="pagination" id="gamesPagination"></div>
        </div>
      </div>
    </div>

    <div class="page" id="skinsPage">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-palette text-warning"></i>
            Skins Management
          </div>
          <div class="card-actions">
            <button class="btn btn-primary btn-sm" id="addSkinBtn">
              <i class="fas fa-plus"></i> Add Skin
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="admin-table" id="skinsTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Value</th>
                  <th>Rarity</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="skinsTableBody">
                <tr>
                  <td colspan="6" class="text-center">Loading skins...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="page" id="addSkinsPage">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-plus-circle text-success"></i>
            Add New Skin
          </div>
        </div>
        <div class="card-body">
          <form id="addSkinForm">
            <div class="form-group">
              <label class="form-label">Skin Name</label>
              <input type="text" class="form-control" id="skinName" placeholder="Enter skin name" required>
            </div>
            <div class="form-group">
              <label class="form-label">Value</label>
              <input type="number" class="form-control" id="skinValue" placeholder="Enter value" required>
            </div>
            <div class="form-group">
              <label class="form-label">Rarity</label>
              <select class="form-control" id="skinRarity" required>
                <option value="">Select rarity</option>
                <option value="Common">Common</option>
                <option value="Uncommon">Uncommon</option>
                <option value="Rare">Rare</option>
                <option value="Epic">Epic</option>
                <option value="Legendary">Legendary</option>
                <option value="Mythic">Mythic</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Image URL</label>
              <input type="text" class="form-control" id="skinImageUrl" placeholder="Enter image URL">
            </div>
            <div class="form-group" id="skinPreviewContainer" style="display: none;">
              <label class="form-label">Preview</label>
              <div style="background-color: var(--bg-light); padding: 16px; border-radius: 8px; text-align: center;">
                <img id="skinPreviewImage" src="" alt="Skin Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
              </div>
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Skin
              </button>
              <button type="reset" class="btn btn-outline">
                <i class="fas fa-times"></i> Reset
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="page" id="giveSkinsPage">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-gift text-accent"></i>
            Give Skins to User
          </div>
        </div>
        <div class="card-body">
          <form id="giveSkinsForm">
            <div class="form-group">
              <label class="form-label">Discord ID</label>
              <input type="text" class="form-control" id="giveDiscordId" placeholder="Enter Discord ID" required>
            </div>
            <div class="form-group">
              <label class="form-label">Select Skins</label>
              <div id="giveSkinSelectionContainer">
                <div class="empty-state">
                  <i class="fas fa-spinner"></i>
                  <h3>Loading skins...</h3>
                </div>
              </div>
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-gift"></i> Give Skins
              </button>
              <button type="reset" class="btn btn-outline">
                <i class="fas fa-times"></i> Reset
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="page" id="logsPage">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-file-alt text-secondary"></i>
            System Logs
          </div>
          <div class="card-actions">
            <button class="btn btn-outline btn-sm" id="refreshLogs">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="empty-state">
            <i class="fas fa-file-alt"></i>
            <h3>Logs feature coming soon</h3>
            <p class="empty-state-message">The log viewing functionality is currently under development.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="editSkinModal">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">Edit Skin</h3>
        <button class="modal-close" id="closeEditSkinModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editSkinForm">
          <input type="hidden" id="editSkinId">
          <div class="form-group">
            <label class="form-label">Skin Name</label>
            <input type="text" class="form-control" id="editSkinName" placeholder="Enter skin name" required>
          </div>
          <div class="form-group">
            <label class="form-label">Value</label>
            <input type="number" class="form-control" id="editSkinValue" placeholder="Enter value" required>
          </div>
          <div class="form-group">
            <label class="form-label">Rarity</label>
            <select class="form-control" id="editSkinRarity" required>
              <option value="">Select rarity</option>
              <option value="Common">Common</option>
              <option value="Uncommon">Uncommon</option>
              <option value="Rare">Rare</option>
              <option value="Epic">Epic</option>
              <option value="Legendary">Legendary</option>
              <option value="Mythic">Mythic</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Image URL</label>
            <input type="text" class="form-control" id="editSkinImageUrl" placeholder="Enter image URL">
          </div>
          <div class="form-group" id="editSkinPreviewContainer" style="display: none;">
            <label class="form-label">Preview</label>
            <div style="background-color: var(--bg-light); padding: 16px; border-radius: 8px; text-align: center;">
              <img id="editSkinPreviewImage" src="" alt="Skin Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancelEditSkin">Cancel</button>
        <button class="btn btn-primary" id="saveEditSkin">Save Changes</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="userGiveSkinsModal">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">Give Skins to User</h3>
        <button class="modal-close" id="closeUserGiveSkinsModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="userGiveSkinsForm">
          <input type="hidden" id="giveSkinsToDiscordId">
          <div class="form-group">
            <label class="form-label">User</label>
            <div id="giveSkinsToUserInfo" style="padding: 12px; background-color: var(--bg-light); border-radius: 8px;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600;" id="giveSkinsUserAvatar">U</div>
                <div>
                  <div style="font-weight: 500;" id="giveSkinsUserName">Username</div>
                  <div style="font-size: 13px; color: var(--text-muted);" id="giveSkinsUserDiscord">Discord ID</div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Select Skins</label>
            <div id="userGiveSkinSelectionContainer">
              <div class="empty-state">
                <i class="fas fa-spinner"></i>
                <h3>Loading skins...</h3>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancelUserGiveSkins">Cancel</button>
        <button class="btn btn-primary" id="confirmUserGiveSkins">Give Skins</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="gameDetailsModal">
    <div class="modal-container" style="max-width: 700px;">
      <div class="modal-header">
        <h3 class="modal-title">Game Details</h3>
        <button class="modal-close" id="closeGameDetailsModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <div class="tab active" data-modal-tab="gameInfo">Game Info</div>
          <div class="tab" data-modal-tab="creatorInfo">Creator</div>
          <div class="tab" data-modal-tab="joinerInfo">Joiner</div>
          <div class="tab" data-modal-tab="skinDetails">Skins</div>
        </div>
        
        <div class="tab-content active" data-modal-tab-content="gameInfo">
          <div style="margin-bottom: 16px;">
            <div style="display: flex; flex-wrap: wrap; gap: 16px;">
              <div style="flex: 1; min-width: 200px;">
                <h4 style="font-size: 16px; margin-bottom: 12px;">Game Information</h4>
                <div style="background-color: var(--bg-light); padding: 16px; border-radius: 8px;">
                  <div style="margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);">Game ID</div>
                    <div style="font-weight: 500; word-break: break-all;" id="modalGameId">-</div>
                  </div>
                  <div style="margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);">Status</div>
                    <div id="modalGameStatus">-</div>
                  </div>
                  <div style="margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);">Created At</div>
                    <div id="modalGameCreated">-</div>
                  </div>
                  <div>
                    <div style="font-size: 13px; color: var(--text-muted);">Completed At</div>
                    <div id="modalGameCompleted">-</div>
                  </div>
                </div>
              </div>
              
              <div style="flex: 1; min-width: 200px;">
                <h4 style="font-size: 16px; margin-bottom: 12px;">Game Result</h4>
                <div style="background-color: var(--bg-light); padding: 16px; border-radius: 8px;">
                  <div style="margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);">Winner</div>
                    <div style="font-weight: 500;" id="modalGameWinner">-</div>
                  </div>
                  <div style="margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);">Total Value</div>
                    <div id="modalGameTotalValue">-</div>
                  </div>
                  <div>
                    <div style="font-size: 13px; color: var(--text-muted);">Server Seed</div>
                    <div style="font-size: 13px; word-break: break-all;" id="modalGameServerSeed">-</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tab-content" data-modal-tab-content="creatorInfo">
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
            <div style="width: 60px; height: 60px; border-radius: 50%; background-color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 24px;" id="modalCreatorAvatar">C</div>
            <div>
              <div style="font-size: 18px; font-weight: 600;" id="modalCreatorName">Creator Name</div>
              <div style="color: var(--text-muted);" id="modalCreatorDiscord">Discord ID</div>
            </div>
          </div>
          
          <h4 style="font-size: 16px; margin-bottom: 12px;">Creator's Bet</h4>
          <div id="modalCreatorSkinsList" style="margin-bottom: 16px;">
          </div>
          
          <div style="display: flex; justify-content: flex-end;">
            <button class="btn btn-outline btn-sm" id="viewCreatorProfile">
              <i class="fas fa-user"></i> View Profile
            </button>
          </div>
        </div>
        
        <div class="tab-content" data-modal-tab-content="joinerInfo">
          <div id="modalJoinerContent">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
              <div style="width: 60px; height: 60px; border-radius: 50%; background-color: var(--secondary); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 24px;" id="modalJoinerAvatar">J</div>
              <div>
                <div style="font-size: 18px; font-weight: 600;" id="modalJoinerName">Joiner Name</div>
                <div style="color: var(--text-muted);" id="modalJoinerDiscord">Discord ID</div>
              </div>
            </div>
            
            <h4 style="font-size: 16px; margin-bottom: 12px;">Joiner's Bet</h4>
            <div id="modalJoinerSkinsList" style="margin-bottom: 16px;">
            </div>
            
            <div style="display: flex; justify-content: flex-end;">
              <button class="btn btn-outline btn-sm" id="viewJoinerProfile">
                <i class="fas fa-user"></i> View Profile
              </button>
            </div>
          </div>
          
          <div class="empty-state" id="noJoinerMessage" style="display: none;">
            <i class="fas fa-user-slash"></i>
            <h3>No Joiner</h3>
            <p class="empty-state-message">This game doesn't have a joiner yet.</p>
          </div>
        </div>
        
        <div class="tab-content" data-modal-tab-content="skinDetails">
          <div class="tabs">
            <div class="tab active" data-skin-tab="allSkins">All Skins</div>
            <div class="tab" data-skin-tab="creatorSkins">Creator's Skins</div>
            <div class="tab" data-skin-tab="joinerSkins">Joiner's Skins</div>
          </div>
          
          <div class="tab-content active" data-skin-tab-content="allSkins">
            <div id="modalAllSkinsList" style="margin-top: 16px;">
            </div>
          </div>
          
          <div class="tab-content" data-skin-tab-content="creatorSkins">
            <div id="modalCreatorSkinsTabList" style="margin-top: 16px;">
            </div>
          </div>
          
          <div class="tab-content" data-skin-tab-content="joinerSkins">
            <div id="modalJoinerSkinsTabList" style="margin-top: 16px;">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="closeGameDetailBtn">Close</button>
      </div>
    </div>
  </div>



  <div class="notification" id="adminNotification">
    <div class="notification-icon bg-success">
      <i class="fas fa-check"></i>
    </div>
    <div class="notification-content">
      <div class="notification-title" id="notificationTitle">Success</div>
      <div class="notification-message" id="notificationMessage">Operation completed successfully.</div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading"></div>
    <div class="loading-text" id="loadingText">Loading...</div>
  </div>

  <script>
    const api_url = 'http://localhost:3000';
    let adminKey = '';
    
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const adminKeyInput = document.getElementById('adminKey');
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const sidebarClose = document.getElementById('sidebarClose');
    const menuItems = document.querySelectorAll('.menu-item');
    const pages = document.querySelectorAll('.page');
    const pageTitle = document.getElementById('pageTitle');
    
    const totalUsersElement = document.getElementById('totalUsers');
    const totalGamesElement = document.getElementById('totalGames');
    const totalSkinsElement = document.getElementById('totalSkins');
    const totalValueElement = document.getElementById('totalValue');
    const activeGamesElement = document.getElementById('activeGames');
    const pendingApprovalsElement = document.getElementById('pendingApprovals');
    const activeSessionsElement = document.getElementById('activeSessions');
    const newRegistrationsElement = document.getElementById('newRegistrations');
    
    const recentGamesBody = document.getElementById('recentGamesBody');
    const usersTableBody = document.getElementById('usersTableBody');
    const gamesTableBody = document.getElementById('gamesTableBody');
    const skinsTableBody = document.getElementById('skinsTableBody');
    
    const usersPagination = document.getElementById('usersPagination');
    const gamesPagination = document.getElementById('gamesPagination');
    
    const userSearch = document.getElementById('userSearch');
    
    const refreshServerStatus = document.getElementById('refreshServerStatus');
    const refreshGames = document.getElementById('refreshGames');
    const refreshLogs = document.getElementById('refreshLogs');
    const addSkinBtn = document.getElementById('addSkinBtn');
    const backToUsers = document.getElementById('backToUsers');
    
    const editSkinModal = document.getElementById('editSkinModal');
    const closeEditSkinModal = document.getElementById('closeEditSkinModal');
    const cancelEditSkin = document.getElementById('cancelEditSkin');
    const saveEditSkin = document.getElementById('saveEditSkin');
    
    const userGiveSkinsModal = document.getElementById('userGiveSkinsModal');
    const closeUserGiveSkinsModal = document.getElementById('closeUserGiveSkinsModal');
    const cancelUserGiveSkins = document.getElementById('cancelUserGiveSkins');
    const confirmUserGiveSkins = document.getElementById('confirmUserGiveSkins');
    
    const gameDetailsModal = document.getElementById('gameDetailsModal');
    const closeGameDetailsModal = document.getElementById('closeGameDetailsModal');
    const closeGameDetailBtn = document.getElementById('closeGameDetailBtn');
    
    const addSkinForm = document.getElementById('addSkinForm');
    const editSkinForm = document.getElementById('editSkinForm');
    const giveSkinsForm = document.getElementById('giveSkinsForm');
    const userGiveSkinsForm = document.getElementById('userGiveSkinsForm');
    
    const skinName = document.getElementById('skinName');
    const skinValue = document.getElementById('skinValue');
    const skinRarity = document.getElementById('skinRarity');
    const skinImageUrl = document.getElementById('skinImageUrl');
    const skinPreviewContainer = document.getElementById('skinPreviewContainer');
    const skinPreviewImage = document.getElementById('skinPreviewImage');
    
    const editSkinId = document.getElementById('editSkinId');
    const editSkinName = document.getElementById('editSkinName');
    const editSkinValue = document.getElementById('editSkinValue');
    const editSkinRarity = document.getElementById('editSkinRarity');
    const editSkinImageUrl = document.getElementById('editSkinImageUrl');
    const editSkinPreviewContainer = document.getElementById('editSkinPreviewContainer');
    const editSkinPreviewImage = document.getElementById('editSkinPreviewImage');
    
    const giveDiscordId = document.getElementById('giveDiscordId');
    const giveSkinSelectionContainer = document.getElementById('giveSkinSelectionContainer');
    
    const giveSkinsToDiscordId = document.getElementById('giveSkinsToDiscordId');
    const giveSkinsUserName = document.getElementById('giveSkinsUserName');
    const giveSkinsUserDiscord = document.getElementById('giveSkinsUserDiscord');
    const giveSkinsUserAvatar = document.getElementById('giveSkinsUserAvatar');
    const userGiveSkinSelectionContainer = document.getElementById('userGiveSkinSelectionContainer');
    
    const userDetailName = document.getElementById('userDetailName');
    const userDiscordId = document.getElementById('userDiscordId');
    const userRegisteredAt = document.getElementById('userRegisteredAt');
    const userAvatar = document.getElementById('userAvatar');
    const userInventory = document.getElementById('userInventory');
    const userGamesBody = document.getElementById('userGamesBody');
    const userTotalGames = document.getElementById('userTotalGames');
    const userWins = document.getElementById('userWins');
    const userLosses = document.getElementById('userLosses');
    const userWinRate = document.getElementById('userWinRate');
    const userGamesCreated = document.getElementById('userGamesCreated');
    const userGamesJoined = document.getElementById('userGamesJoined');
    const userGamesCancelled = document.getElementById('userGamesCancelled');
    const userInventoryValue = document.getElementById('userInventoryValue');
    
    const addSkinsToUser = document.getElementById('addSkinsToUser');
    const clearUserNotifications = document.getElementById('clearUserNotifications');
    
    const adminNotification = document.getElementById('adminNotification');
    const notificationTitle = document.getElementById('notificationTitle');
    const notificationMessage = document.getElementById('notificationMessage');
    
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');
    
    const modalGameId = document.getElementById('modalGameId');
    const modalGameStatus = document.getElementById('modalGameStatus');
    const modalGameCreated = document.getElementById('modalGameCreated');
    const modalGameCompleted = document.getElementById('modalGameCompleted');
    const modalGameWinner = document.getElementById('modalGameWinner');
    const modalGameTotalValue = document.getElementById('modalGameTotalValue');
    const modalGameServerSeed = document.getElementById('modalGameServerSeed');
    
    const modalCreatorAvatar = document.getElementById('modalCreatorAvatar');
    const modalCreatorName = document.getElementById('modalCreatorName');
    const modalCreatorDiscord = document.getElementById('modalCreatorDiscord');
    const modalCreatorSkinsList = document.getElementById('modalCreatorSkinsList');
    
    const modalJoinerAvatar = document.getElementById('modalJoinerAvatar');
    const modalJoinerName = document.getElementById('modalJoinerName');
    const modalJoinerDiscord = document.getElementById('modalJoinerDiscord');
    const modalJoinerSkinsList = document.getElementById('modalJoinerSkinsList');
    const modalJoinerContent = document.getElementById('modalJoinerContent');
    const noJoinerMessage = document.getElementById('noJoinerMessage');
    
    const modalAllSkinsList = document.getElementById('modalAllSkinsList');
    const modalCreatorSkinsTabList = document.getElementById('modalCreatorSkinsTabList');
    const modalJoinerSkinsTabList = document.getElementById('modalJoinerSkinsTabList');
    const viewCreatorProfile = document.getElementById('viewCreatorProfile');
    const viewJoinerProfile = document.getElementById('viewJoinerProfile');
    
    let currentPage = 'dashboard';
    let currentUserPage = 1;
    let currentGamesPage = 1;
    let currentUserSearchTerm = '';
    let allSkins = [];
    let currentViewingUserId = null;
    let currentGameData = null;
    
    function formatDate(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleString();
    }
    
    function formatValue(value) {
      return parseInt(value).toLocaleString();
    }
    
    function showLoading(message = 'Loading...') {
      loadingText.textContent = message;
      loadingOverlay.style.display = 'flex';
    }
    
    function hideLoading() {
      loadingOverlay.style.display = 'none';
    }
    
    function showNotification(title, message, type = 'success') {
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      
      const icon = adminNotification.querySelector('.notification-icon');
      icon.className = 'notification-icon';
      
      if (type === 'success') {
        icon.classList.add('bg-success');
        icon.innerHTML = '<i class="fas fa-check"></i>';
      } else if (type === 'error') {
        icon.classList.add('bg-danger');
        icon.innerHTML = '<i class="fas fa-times"></i>';
      } else if (type === 'warning') {
        icon.classList.add('bg-warning');
        icon.innerHTML = '<i class="fas fa-exclamation"></i>';
      } else if (type === 'info') {
        icon.classList.add('bg-secondary');
        icon.innerHTML = '<i class="fas fa-info"></i>';
      }
      
      adminNotification.classList.add('show');
      
      setTimeout(() => {
        adminNotification.classList.remove('show');
      }, 3000);
    }
    
    function getStatusBadgeHTML(status) {
      let className = '';
      let text = status.charAt(0).toUpperCase() + status.slice(1);
      
      switch (status) {
        case 'active':
          className = 'bg-success';
          break;
        case 'completed':
          className = 'bg-primary';
          break;
        case 'cancelled':
          className = 'bg-danger';
          text = 'Cancelled';
          break;
        case 'pending_approval':
          className = 'bg-warning';
          text = 'Pending Approval';
          break;
        case 'rejected':
          className = 'bg-danger';
          text = 'Rejected';
          break;
        default:
          className = 'bg-secondary';
      }
      
      return `<span class="status-badge ${className}">${text}</span>`;
    }
    
    function getRarityBadgeHTML(rarity) {
      let className = '';
      
      switch (rarity.toLowerCase()) {
        case 'common':
          className = 'bg-secondary';
          break;
        case 'uncommon':
          className = 'bg-success';
          break;
        case 'rare':
          className = 'bg-primary';
          break;
        case 'epic':
          className = 'bg-accent';
          break;
        case 'legendary':
          className = 'bg-warning';
          break;
        case 'mythic':
          className = 'bg-danger';
          break;
        default:
          className = 'bg-secondary';
      }
      
      return `<span class="skin-rarity ${className}">${rarity}</span>`;
    }
    
    function generatePagination(currentPage, totalPages, container, onPageChange) {
      container.innerHTML = '';
      
      if (totalPages <= 1) {
        return;
      }
      
      const prevBtn = document.createElement('a');
      prevBtn.href = '#';
      prevBtn.className = 'pagination-item';
      prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
      if (currentPage === 1) {
        prevBtn.style.opacity = '0.5';
        prevBtn.style.pointerEvents = 'none';
      } else {
        prevBtn.onclick = (e) => {
          e.preventDefault();
          onPageChange(currentPage - 1);
        };
      }
      container.appendChild(prevBtn);
      
      const maxPages = 5;
      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, startPage + maxPages - 1);
      
      if (endPage - startPage < maxPages - 1) {
        startPage = Math.max(1, endPage - maxPages + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageLink = document.createElement('a');
        pageLink.href = '#';
        pageLink.className = 'pagination-item';
        if (i === currentPage) {
          pageLink.classList.add('active');
        }
        pageLink.textContent = i;
        pageLink.onclick = (e) => {
          e.preventDefault();
          onPageChange(i);
        };
        container.appendChild(pageLink);
      }
      
      const nextBtn = document.createElement('a');
      nextBtn.href = '#';
      nextBtn.className = 'pagination-item';
      nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
      if (currentPage === totalPages) {
        nextBtn.style.opacity = '0.5';
        nextBtn.style.pointerEvents = 'none';
      } else {
        nextBtn.onclick = (e) => {
          e.preventDefault();
          onPageChange(currentPage + 1);
        };
      }
      container.appendChild(nextBtn);
    }
    
    async function fetchWithAdminKey(url, options = {}) {
      try {
        const headers = {
          'Content-Type': 'application/json',
          'Admin-Key': adminKey,
          ...(options.headers || {})
        };
        
        const response = await fetch(url, {
          ...options,
          headers
        });
        
        if (response.status === 403) {
          showNotification('Unauthorized', 'Invalid admin key. Please check your admin key.', 'error');
          return null;
        }
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.error || 'An error occurred');
        }
        
        return await response.json();
      } catch (error) {
        console.error('API Error:', error);
        showNotification('Error', error.message, 'error');
        return null;
      }
    }
    
    async function fetchDashboardStats() {
      const data = await fetchWithAdminKey(`${api_url}/admin/stats`);
      
      if (data) {
        totalUsersElement.textContent = formatValue(data.usersCount || 0);
        totalGamesElement.textContent = formatValue(data.totalGames || 0);
        totalSkinsElement.textContent = formatValue(data.totalSkins || 0);
      }
    }
    
    async function fetchServerMetrics() {
      const data = await fetchWithAdminKey(`${api_url}/admin/metrics`);
      
      if (data) {
        activeGamesElement.textContent = formatValue(data.activeGames || 0);
        pendingApprovalsElement.textContent = formatValue(data.pendingApprovalGames || 0);
        activeSessionsElement.textContent = formatValue(data.activeSessions || 0);
        newRegistrationsElement.textContent = formatValue(data.registrationsLast24h || 0);
        totalValueElement.textContent = formatValue(data.totalValueLocked || 0);
      }
    }
    
    async function fetchRecentGames() {
      const data = await fetchWithAdminKey(`${api_url}/admin/games?page=1&limit=5`);
      
      if (data && data.games) {
        recentGamesBody.innerHTML = '';
        
        if (data.games.length === 0) {
          recentGamesBody.innerHTML = `
            <tr>
              <td colspan="7" class="text-center">No games found</td>
            </tr>
          `;
          return;
        }
        
        data.games.forEach(game => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${game.id.substring(0, 8)}...</td>
            <td>${game.creator_roblox_username}</td>
            <td>${game.joiner_roblox_username || '-'}</td>
            <td>${getStatusBadgeHTML(game.status)}</td>
            <td>${formatValue(game.creator_skins_value)} ${game.joiner_skins_value ? '+ ' + formatValue(game.joiner_skins_value) : ''}</td>
            <td>${formatDate(game.created_at)}</td>
            <td>
              <button class="btn btn-outline btn-sm view-game-btn" data-game-id="${game.id}">
                <i class="fas fa-eye"></i> View
              </button>
            </td>
          `;
          recentGamesBody.appendChild(row);
        });
        
        document.querySelectorAll('.view-game-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const gameId = btn.getAttribute('data-game-id');
            viewGameDetails(gameId);
          });
        });
      }
    }
    
    async function fetchUsers(page = 1, search = '') {
      showLoading('Loading users...');
      
      currentUserPage = page;
      currentUserSearchTerm = search;
      
      const data = await fetchWithAdminKey(`${api_url}/admin/users?page=${page}&limit=20${search ? '&search=' + encodeURIComponent(search) : ''}`);
      
      hideLoading();
      
      if (data && data.users) {
        usersTableBody.innerHTML = '';
        
        if (data.users.length === 0) {
          usersTableBody.innerHTML = `
            <tr>
              <td colspan="4" class="text-center">No users found</td>
            </tr>
          `;
          return;
        }
        
        data.users.forEach(user => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${user.discord_id}</td>
            <td>${user.roblox_username}</td>
            <td>${formatDate(user.registered_at)}</td>
            <td>
              <div class="table-actions">
                <button class="btn btn-outline btn-sm view-user-btn" data-discord-id="${user.discord_id}">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-success btn-sm give-skins-btn" data-discord-id="${user.discord_id}" data-username="${user.roblox_username}">
                  <i class="fas fa-gift"></i> Give Skins
                </button>
              </div>
            </td>
          `;
          usersTableBody.appendChild(row);
        });
        
        document.querySelectorAll('.view-user-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const discordId = btn.getAttribute('data-discord-id');
            viewUserDetails(discordId);
          });
        });
        
        document.querySelectorAll('.give-skins-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const discordId = btn.getAttribute('data-discord-id');
            const username = btn.getAttribute('data-username');
            openGiveSkinsModal(discordId, username);
          });
        });
        
        generatePagination(
          data.pagination.page,
          data.pagination.pages,
          usersPagination,
          (newPage) => fetchUsers(newPage, search)
        );
      }
    }
    
    async function fetchGames(page = 1) {
      showLoading('Loading games...');
      
      currentGamesPage = page;
      
      const data = await fetchWithAdminKey(`${api_url}/admin/games?page=${page}&limit=20`);
      
      hideLoading();
      
      if (data && data.games) {
        gamesTableBody.innerHTML = '';
        
        if (data.games.length === 0) {
          gamesTableBody.innerHTML = `
            <tr>
              <td colspan="7" class="text-center">No games found</td>
            </tr>
          `;
          return;
        }
        
        data.games.forEach(game => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${game.id.substring(0, 8)}...</td>
            <td>${game.creator_roblox_username}</td>
            <td>${game.joiner_roblox_username || '-'}</td>
            <td>${getStatusBadgeHTML(game.status)}</td>
            <td>${formatValue(game.creator_skins_value)} ${game.joiner_skins_value ? '+ ' + formatValue(game.joiner_skins_value) : ''}</td>
            <td>${formatDate(game.created_at)}</td>
            <td>
              <button class="btn btn-outline btn-sm view-game-btn" data-game-id="${game.id}">
                <i class="fas fa-eye"></i> View
              </button>
            </td>
          `;
          gamesTableBody.appendChild(row);
        });
        
        document.querySelectorAll('.view-game-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const gameId = btn.getAttribute('data-game-id');
            viewGameDetails(gameId);
          });
        });
        
        generatePagination(
          data.pagination.page,
          data.pagination.pages,
          gamesPagination,
          (newPage) => fetchGames(newPage)
        );
      }
    }
    
    async function fetchSkins() {
      showLoading('Loading skins...');
      
      const data = await fetchWithAdminKey(`${api_url}/admin/skins`);
      
      hideLoading();
      
      if (data && data.skins) {
        allSkins = data.skins;
        skinsTableBody.innerHTML = '';
        
        if (data.skins.length === 0) {
          skinsTableBody.innerHTML = `
            <tr>
              <td colspan="6" class="text-center">No skins found</td>
            </tr>
          `;
          return;
        }
        
        data.skins.forEach(skin => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${skin.id}</td>
            <td>
              <img src="${skin.image_url || 'https://via.placeholder.com/40'}" alt="${skin.name}" class="skin-image" style="width: 40px; height: 40px;">
            </td>
            <td>${skin.name}</td>
            <td>${formatValue(skin.value)}</td>
            <td>${getRarityBadgeHTML(skin.rarity)}</td>
            <td>
              <div class="table-actions">
                <button class="btn btn-outline btn-sm edit-skin-btn" data-skin-id="${skin.id}">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-sm delete-skin-btn" data-skin-id="${skin.id}" data-skin-name="${skin.name}">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </td>
          `;
          skinsTableBody.appendChild(row);
        });
        
        document.querySelectorAll('.edit-skin-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const skinId = btn.getAttribute('data-skin-id');
            const skin = allSkins.find(s => s.id == skinId);
            if (skin) {
              openEditSkinModal(skin);
            }
          });
        });
        
        document.querySelectorAll('.delete-skin-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const skinId = btn.getAttribute('data-skin-id');
            const skinName = btn.getAttribute('data-skin-name');
            if (confirm(`Are you sure you want to delete "${skinName}"? This action cannot be undone.`)) {
              deleteSkin(skinId);
            }
          });
        });
        
        updateGiveSkinSelection(giveSkinSelectionContainer);
      }
    }
    
    async function fetchUserDetails(discordId) {
      showLoading('Loading user details...');
      
      currentViewingUserId = discordId;
      
      const data = await fetchWithAdminKey(`${api_url}/admin/users/${discordId}`);
      
      hideLoading();
      
      if (data && data.user) {
        userDetailName.textContent = data.user.roblox_username;
        userDiscordId.textContent = data.user.discord_id;
        userRegisteredAt.textContent = formatDate(data.user.registered_at);
        userAvatar.textContent = data.user.roblox_username.charAt(0).toUpperCase();
        
        renderUserInventory(data.inventory);
        
        userTotalGames.textContent = data.gameStats.total_games || 0;
        userWins.textContent = data.gameStats.games_won || 0;
        userLosses.textContent = data.gameStats.games_lost || 0;
        userWinRate.textContent = `${data.gameStats.winRate || 0}%`;
        userGamesCreated.textContent = data.gameStats.games_created || 0;
        userGamesJoined.textContent = data.gameStats.games_joined || 0;
        userGamesCancelled.textContent = data.gameStats.games_cancelled || 0;
        userInventoryValue.textContent = formatValue(data.inventory.totalValue || 0);
        
        showPage('userDetails');
      }
    }
    
    function renderUserInventory(inventory) {
      if (!inventory || !inventory.items || inventory.items.length === 0) {
        userInventory.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-box-open"></i>
            <h3>No items in inventory</h3>
            <p class="empty-state-message">This user doesn't have any skins in their inventory.</p>
          </div>
        `;
        return;
      }
      
      userInventory.innerHTML = '';
      
      inventory.items.forEach(item => {
        const inventoryItem = document.createElement('div');
        inventoryItem.className = 'inventory-item';
        inventoryItem.innerHTML = `
          <img src="${item.image_url || 'https://via.placeholder.com/48'}" alt="${item.skin_name}" class="skin-image">
          <div class="skin-info">
            <div class="skin-name">${item.skin_name}</div>
            <div class="skin-value">${formatValue(item.value)} value</div>
          </div>
          <div style="display: flex; gap: 12px; align-items: center;">
            ${getRarityBadgeHTML(item.rarity)}
            <div class="skin-count">${item.count}x</div>
          </div>
        `;
        userInventory.appendChild(inventoryItem);
      });
    }
    
    async function viewGameDetails(gameId) {
      showLoading('Loading game details...');
      
      const data = await fetchWithAdminKey(`${api_url}/coinflip/game/${gameId}`);
      
      hideLoading();
      
      if (data) {
        currentGameData = data;
        
        modalGameId.textContent = data.gameId;
        modalGameStatus.innerHTML = getStatusBadgeHTML(data.status);
        modalGameCreated.textContent = formatDate(data.createdAt);
        modalGameCompleted.textContent = data.completedAt ? formatDate(data.completedAt) : '-';
        
        if (data.winner) {
          modalGameWinner.textContent = data.winner.robloxUsername;
          modalGameServerSeed.textContent = data.serverSeed || '-';
        } else {
          modalGameWinner.textContent = '-';
          modalGameServerSeed.textContent = '-';
        }
        
        const creatorValue = data.creator.skinValue || 0;
        const joinerValue = data.joiner?.skinValue || 0;
        modalGameTotalValue.textContent = formatValue(creatorValue + joinerValue);
        
        modalCreatorAvatar.textContent = data.creator.robloxUsername.charAt(0).toUpperCase();
        modalCreatorName.textContent = data.creator.robloxUsername;
        modalCreatorDiscord.textContent = data.creator.discordId;
        
        modalCreatorSkinsList.innerHTML = '';
        if (data.creatorSkins && data.creatorSkins.length > 0) {
          data.creatorSkins.forEach(skin => {
            const skinElement = document.createElement('div');
            skinElement.className = 'inventory-item';
            const skinDetails = allSkins.find(s => s.name === skin) || { value: 0, rarity: 'Unknown', image_url: null };
            skinElement.innerHTML = `
              <img src="${skinDetails.image_url || 'https://via.placeholder.com/48'}" alt="${skin}" class="skin-image">
              <div class="skin-info">
                <div class="skin-name">${skin}</div>
                <div class="skin-value">${formatValue(skinDetails.value)} value</div>
              </div>
              ${getRarityBadgeHTML(skinDetails.rarity)}
            `;
            modalCreatorSkinsList.appendChild(skinElement);
          });
        } else {
          modalCreatorSkinsList.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--text-muted);">No skins information available</div>';
        }
        
        if (data.joiner) {
          modalJoinerContent.style.display = 'block';
          noJoinerMessage.style.display = 'none';
          
          modalJoinerAvatar.textContent = data.joiner.robloxUsername.charAt(0).toUpperCase();
          modalJoinerName.textContent = data.joiner.robloxUsername;
          modalJoinerDiscord.textContent = data.joiner.discordId;
          
          modalJoinerSkinsList.innerHTML = '';
          if (data.joinerSkins && data.joinerSkins.length > 0) {
            data.joinerSkins.forEach(skin => {
              const skinElement = document.createElement('div');
              skinElement.className = 'inventory-item';
              const skinDetails = allSkins.find(s => s.name === skin) || { value: 0, rarity: 'Unknown', image_url: null };
              skinElement.innerHTML = `
                <img src="${skinDetails.image_url || 'https://via.placeholder.com/48'}" alt="${skin}" class="skin-image">
                <div class="skin-info">
                  <div class="skin-name">${skin}</div>
                  <div class="skin-value">${formatValue(skinDetails.value)} value</div>
                </div>
                ${getRarityBadgeHTML(skinDetails.rarity)}
              `;
              modalJoinerSkinsList.appendChild(skinElement);
            });
          } else {
            modalJoinerSkinsList.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--text-muted);">No skins information available</div>';
          }
          
          viewJoinerProfile.onclick = () => {
            gameDetailsModal.classList.remove('active');
            viewUserDetails(data.joiner.discordId);
          };
        } else {
          modalJoinerContent.style.display = 'none';
          noJoinerMessage.style.display = 'block';
          viewJoinerProfile.onclick = null;
        }
        
        modalAllSkinsList.innerHTML = '';
        const allGameSkins = [...(data.creatorSkins || [])];
        if (data.joinerSkins) {
          allGameSkins.push(...data.joinerSkins);
        }
        
        if (allGameSkins.length > 0) {
          allGameSkins.forEach(skin => {
            const skinElement = document.createElement('div');
            skinElement.className = 'inventory-item';
            const skinDetails = allSkins.find(s => s.name === skin) || { value: 0, rarity: 'Unknown', image_url: null };
            skinElement.innerHTML = `
              <img src="${skinDetails.image_url || 'https://via.placeholder.com/48'}" alt="${skin}" class="skin-image">
              <div class="skin-info">
                <div class="skin-name">${skin}</div>
                <div class="skin-value">${formatValue(skinDetails.value)} value</div>
              </div>
              ${getRarityBadgeHTML(skinDetails.rarity)}
            `;
            modalAllSkinsList.appendChild(skinElement);
          });
        } else {
          modalAllSkinsList.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--text-muted);">No skins information available</div>';
        }
        
        modalCreatorSkinsTabList.innerHTML = '';
        if (data.creatorSkins && data.creatorSkins.length > 0) {
          data.creatorSkins.forEach(skin => {
            const skinElement = document.createElement('div');
            skinElement.className = 'inventory-item';
            const skinDetails = allSkins.find(s => s.name === skin) || { value: 0, rarity: 'Unknown', image_url: null };
            skinElement.innerHTML = `
              <img src="${skinDetails.image_url || 'https://via.placeholder.com/48'}" alt="${skin}" class="skin-image">
              <div class="skin-info">
                <div class="skin-name">${skin}</div>
                <div class="skin-value">${formatValue(skinDetails.value)} value</div>
              </div>
              ${getRarityBadgeHTML(skinDetails.rarity)}
            `;
            modalCreatorSkinsTabList.appendChild(skinElement);
          });
        } else {
          modalCreatorSkinsTabList.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--text-muted);">No skins information available</div>';
        }
        
        modalJoinerSkinsTabList.innerHTML = '';
        if (data.joiner && data.joinerSkins && data.joinerSkins.length > 0) {
          data.joinerSkins.forEach(skin => {
            const skinElement = document.createElement('div');
            skinElement.className = 'inventory-item';
            const skinDetails = allSkins.find(s => s.name === skin) || { value: 0, rarity: 'Unknown', image_url: null };
            skinElement.innerHTML = `
              <img src="${skinDetails.image_url || 'https://via.placeholder.com/48'}" alt="${skin}" class="skin-image">
              <div class="skin-info">
                <div class="skin-name">${skin}</div>
                <div class="skin-value">${formatValue(skinDetails.value)} value</div>
              </div>
              ${getRarityBadgeHTML(skinDetails.rarity)}
            `;
            modalJoinerSkinsTabList.appendChild(skinElement);
          });
        } else {
          modalJoinerSkinsTabList.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--text-muted);">No skins information available</div>';
        }
        
        viewCreatorProfile.onclick = () => {
          gameDetailsModal.classList.remove('active');
          viewUserDetails(data.creator.discordId);
        };
        
        document.querySelector('[data-modal-tab="gameInfo"]').classList.add('active');
        document.querySelector('[data-modal-tab="creatorInfo"]').classList.remove('active');
        document.querySelector('[data-modal-tab="joinerInfo"]').classList.remove('active');
        document.querySelector('[data-modal-tab="skinDetails"]').classList.remove('active');
        
        document.querySelector('[data-modal-tab-content="gameInfo"]').classList.add('active');
        document.querySelector('[data-modal-tab-content="creatorInfo"]').classList.remove('active');
        document.querySelector('[data-modal-tab-content="joinerInfo"]').classList.remove('active');
        document.querySelector('[data-modal-tab-content="skinDetails"]').classList.remove('active');
        
        document.querySelector('[data-skin-tab="allSkins"]').classList.add('active');
        document.querySelector('[data-skin-tab="creatorSkins"]').classList.remove('active');
        document.querySelector('[data-skin-tab="joinerSkins"]').classList.remove('active');
        
        document.querySelector('[data-skin-tab-content="allSkins"]').classList.add('active');
        document.querySelector('[data-skin-tab-content="creatorSkins"]').classList.remove('active');
        document.querySelector('[data-skin-tab-content="joinerSkins"]').classList.remove('active');
        
        gameDetailsModal.classList.add('active');
      }
    }
    
    async function addSkin() {
      const name = skinName.value.trim();
      const value = parseInt(skinValue.value);
      const rarity = skinRarity.value;
      const imageUrl = skinImageUrl.value.trim();
      
      if (!name || !value || !rarity) {
        showNotification('Error', 'Please fill in all required fields', 'error');
        return;
      }
      
      showLoading('Adding skin...');
      const data = await fetchWithAdminKey(`${api_url}/admin/skins`, {
        method: 'POST',
        body: JSON.stringify({ 
          name, 
          value, 
          rarity, 
          image_url: imageUrl 
        })
      });
      
      hideLoading();
      
      if (data) {
        showNotification('Success', `Skin "${name}" added successfully`, 'success');
        addSkinForm.reset();
        skinPreviewContainer.style.display = 'none';
        fetchSkins();
      }
    }
    
    async function editSkin() {
      const id = editSkinId.value;
      const name = editSkinName.value.trim();
      const value = parseInt(editSkinValue.value);
      const rarity = editSkinRarity.value;
      const imageUrl = editSkinImageUrl.value.trim();
      
      if (!id || !name || !value || !rarity) {
        showNotification('Error', 'Please fill in all required fields', 'error');
        return;
      }
      
      showLoading('Updating skin...');
      
      const data = await fetchWithAdminKey(`${api_url}/admin/skins/${id}`, {
        method: 'PUT',
        body: JSON.stringify({ 
          name, 
          value, 
          rarity, 
          image_url: imageUrl 
        })
      });
      
      hideLoading();
      
      if (data) {
        showNotification('Success', `Skin "${name}" updated successfully`, 'success');
        editSkinModal.classList.remove('active');
        fetchSkins();
      }
    }
    
    async function deleteSkin(skinId) {
      showLoading('Deleting skin...');
      
      const data = await fetchWithAdminKey(`${api_url}/admin/skins/${skinId}`, {
        method: 'DELETE'
      });
      
      hideLoading();
      
      if (data && data.success) {
        showNotification('Success', 'Skin deleted successfully', 'success');
        fetchSkins();
      }
    }
    
    async function giveSkinsToUser() {
      const discordId = giveDiscordId.value.trim();
      const selectedSkins = [];
      
      document.querySelectorAll('#giveSkinSelectionContainer input[type="checkbox"]:checked').forEach(checkbox => {
        const skinName = checkbox.value;
        const quantity = parseInt(document.getElementById(`quantity-${skinName.replace(/\s+/g, '-')}`).value) || 1;
        
        for (let i = 0; i < quantity; i++) {
          selectedSkins.push(skinName);
        }
      });
      
      if (!discordId) {
        showNotification('Error', 'Please enter a Discord ID', 'error');
        return;
      }
      
      if (selectedSkins.length === 0) {
        showNotification('Error', 'Please select at least one skin', 'error');
        return;
      }
      
      showLoading('Giving skins...');
      
      const data = await fetchWithAdminKey(`${api_url}/admin/users/${discordId}/add-skins`, {
        method: 'POST',
        body: JSON.stringify({ 
          skins: selectedSkins 
        })
      });
      
      hideLoading();
      
      if (data && data.success) {
        showNotification('Success', `Gave ${selectedSkins.length} skin(s) to user`, 'success');
        giveSkinsForm.reset();
        updateGiveSkinSelection(giveSkinSelectionContainer);
      }
    }
    
    async function giveSkinsToCurrentUser() {
      const discordId = giveSkinsToDiscordId.value;
      const selectedSkins = [];
      
      document.querySelectorAll('#userGiveSkinSelectionContainer input[type="checkbox"]:checked').forEach(checkbox => {
        const skinName = checkbox.value;
        const quantity = parseInt(document.getElementById(`user-quantity-${skinName.replace(/\s+/g, '-')}`).value) || 1;
        
        for (let i = 0; i < quantity; i++) {
          selectedSkins.push(skinName);
        }
      });
      
      if (!discordId) {
        showNotification('Error', 'Invalid user selection', 'error');
        return;
      }
      
      if (selectedSkins.length === 0) {
        showNotification('Error', 'Please select at least one skin', 'error');
        return;
      }
      
      showLoading('Giving skins...');
      
      const data = await fetchWithAdminKey(`${api_url}/admin/users/${discordId}/add-skins`, {
        method: 'POST',
        body: JSON.stringify({ 
          skins: selectedSkins 
        })
      });
      
      hideLoading();
      
      if (data && data.success) {
        showNotification('Success', `Gave ${selectedSkins.length} skin(s) to user`, 'success');
        userGiveSkinsModal.classList.remove('active');
        
        if (currentViewingUserId === discordId) {
          fetchUserDetails(discordId);
        }
      }
    }
    
    async function clearUserNotificationsAction() {
      if (!currentViewingUserId) return;
      
      showLoading('Clearing notifications...');
      
      const data = await fetchWithAdminKey(`${api_url}/admin/users/${currentViewingUserId}/clear-notifications`, {
        method: 'POST'
      });
      
      hideLoading();
      
      if (data && data.success) {
        showNotification('Success', `Cleared ${data.clearedCount} notifications for user`, 'success');
      }
    }
    
    function updateGiveSkinSelection(container) {
      if (!allSkins || !allSkins.length) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-box-open"></i>
            <h3>No skins available</h3>
            <p class="empty-state-message">Add some skins first to give them to users.</p>
          </div>
        `;
        return;
      }
      
      const isUserModal = container === userGiveSkinSelectionContainer;
      const idPrefix = isUserModal ? 'user-' : '';
      
      container.innerHTML = '';
      
      const skinsByRarity = {};
      allSkins.forEach(skin => {
        if (!skinsByRarity[skin.rarity]) {
          skinsByRarity[skin.rarity] = [];
        }
        skinsByRarity[skin.rarity].push(skin);
      });
      
      const rarityOrder = ['Common', 'Uncommon', 'Rare', 'Epic', 'Legendary', 'Mythic'];
      
      rarityOrder.forEach(rarity => {
        if (!skinsByRarity[rarity] || !skinsByRarity[rarity].length) return;
        
        const rarityGroup = document.createElement('div');
        rarityGroup.className = 'skin-rarity-group';
        rarityGroup.style.marginBottom = '20px';
        
        const rarityHeader = document.createElement('div');
        rarityHeader.style.marginBottom = '10px';
        rarityHeader.style.display = 'flex';
        rarityHeader.style.alignItems = 'center';
        rarityHeader.style.justifyContent = 'space-between';
        
        rarityHeader.innerHTML = `
          <h4 style="margin: 0; display: flex; align-items: center; gap: 8px;">
            ${getRarityBadgeHTML(rarity)}
            <span>${rarity} Skins</span>
          </h4>
          <div>
            <button type="button" class="btn btn-sm btn-outline select-all-rarity" data-rarity="${rarity}">
              Select All
            </button>
            <button type="button" class="btn btn-sm btn-outline deselect-all-rarity" data-rarity="${rarity}">
              Deselect All
            </button>
          </div>
        `;
        
        rarityGroup.appendChild(rarityHeader);
        
        const skinsList = document.createElement('div');
        skinsList.style.display = 'grid';
        skinsList.style.gridTemplateColumns = 'repeat(auto-fill, minmax(200px, 1fr))';
        skinsList.style.gap = '10px';
        
        skinsByRarity[rarity].forEach(skin => {
          const sanitizedId = skin.name.replace(/\s+/g, '-');
          const skinCheckbox = document.createElement('div');
          skinCheckbox.className = 'skin-selection-item';
          skinCheckbox.style.padding = '10px';
          skinCheckbox.style.backgroundColor = 'var(--bg-light)';
          skinCheckbox.style.borderRadius = '8px';
          
          skinCheckbox.innerHTML = `
            <div style="display: flex; align-items: center; margin-bottom: 8px;">
              <input type="checkbox" id="${idPrefix}skin-${sanitizedId}" value="${skin.name}" style="margin-right: 8px;">
              <label for="${idPrefix}skin-${sanitizedId}" style="margin: 0;">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <img src="${skin.image_url || 'https://via.placeholder.com/32'}" alt="${skin.name}" style="width: 32px; height: 32px; border-radius: 4px;">
                  <div>
                    <div style="font-weight: 500; font-size: 14px;">${skin.name}</div>
                    <div style="font-size: 12px; color: var(--text-muted);">${formatValue(skin.value)} value</div>
                  </div>
                </div>
              </label>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <label for="${idPrefix}quantity-${sanitizedId}" style="margin: 0; font-size: 13px;">Quantity:</label>
              <input type="number" id="${idPrefix}quantity-${sanitizedId}" min="1" value="1" style="width: 60px; padding: 4px 8px; border-radius: 4px; background-color: var(--bg-dark); border: 1px solid var(--border); color: var(--text); text-align: center;">
            </div>
          `;
          
          skinsList.appendChild(skinCheckbox);
        });
        
        rarityGroup.appendChild(skinsList);
        container.appendChild(rarityGroup);
      });
      
      container.querySelectorAll('.select-all-rarity').forEach(button => {
        button.addEventListener('click', () => {
          const rarity = button.getAttribute('data-rarity');
          container.querySelectorAll(`input[type="checkbox"]`).forEach(checkbox => {
            const skin = allSkins.find(s => s.name === checkbox.value);
            if (skin && skin.rarity === rarity) {
              checkbox.checked = true;
            }
          });
        });
      });
      
      container.querySelectorAll('.deselect-all-rarity').forEach(button => {
        button.addEventListener('click', () => {
          const rarity = button.getAttribute('data-rarity');
          container.querySelectorAll(`input[type="checkbox"]`).forEach(checkbox => {
            const skin = allSkins.find(s => s.name === checkbox.value);
            if (skin && skin.rarity === rarity) {
              checkbox.checked = false;
            }
          });
        });
      });
    }
    
    function showPage(pageId) {
      pages.forEach(page => {
        page.classList.remove('active');
      });
      
      menuItems.forEach(item => {
        item.classList.remove('active');
      });
      
      const page = document.getElementById(`${pageId}Page`);
      if (page) {
        page.classList.add('active');
      }
      
      const menuItem = document.querySelector(`.menu-item[data-page="${pageId}"]`);
      if (menuItem) {
        menuItem.classList.add('active');
      }
      
      currentPage = pageId;
      
      switch (pageId) {
        case 'dashboard':
          pageTitle.textContent = 'Dashboard Overview';
          fetchDashboardStats();
          fetchServerMetrics();
          fetchRecentGames();
          break;
        case 'users':
          pageTitle.textContent = 'User Management';
          fetchUsers(currentUserPage, currentUserSearchTerm);
          break;
        case 'games':
          pageTitle.textContent = 'Games Management';
          fetchGames(currentGamesPage);
          break;
        case 'skins':
          pageTitle.textContent = 'Skins Management';
          fetchSkins();
          break;
        case 'add-skins':
          pageTitle.textContent = 'Add New Skin';
          break;
        case 'give-skins':
          pageTitle.textContent = 'Give Skins';
          updateGiveSkinSelection(giveSkinSelectionContainer);
          break;
        case 'logs':
          pageTitle.textContent = 'System Logs';
          break;
        case 'userDetails':
          pageTitle.textContent = 'User Details';
          break;
      }
      
      window.scrollTo(0, 0);
    }
    
    function openEditSkinModal(skin) {
      editSkinId.value = skin.id;
      editSkinName.value = skin.name;
      editSkinValue.value = skin.value;
      editSkinRarity.value = skin.rarity;
      editSkinImageUrl.value = skin.image_url || '';
      
      if (skin.image_url) {
        editSkinPreviewImage.src = skin.image_url;
        editSkinPreviewContainer.style.display = 'block';
      } else {
        editSkinPreviewContainer.style.display = 'none';
      }
      
      editSkinModal.classList.add('active');
    }
    
    function openGiveSkinsModal(discordId, username) {
      giveSkinsToDiscordId.value = discordId;
      giveSkinsUserName.textContent = username;
      giveSkinsUserDiscord.textContent = discordId;
      giveSkinsUserAvatar.textContent = username.charAt(0).toUpperCase();
      
      updateGiveSkinSelection(userGiveSkinSelectionContainer);
      
      userGiveSkinsModal.classList.add('active');
    }
    
    function viewUserDetails(discordId) {
      fetchUserDetails(discordId);
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      menuItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const pageId = item.getAttribute('data-page');
          showPage(pageId);
          
          if (window.innerWidth < 768) {
            sidebar.classList.remove('active');
          }
        });
      });
      
      if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', () => {
          sidebar.classList.add('active');
        });
      }
      
      if (sidebarClose) {
        sidebarClose.addEventListener('click', () => {
          sidebar.classList.remove('active');
        });
      }
      
      adminKeyInput.addEventListener('change', () => {
        adminKey = adminKeyInput.value;
        if (adminKey) {
          localStorage.setItem('adminKey', adminKey);
          fetchDashboardStats();
          fetchServerMetrics();
          fetchRecentGames();
        }
      });
      
      const savedAdminKey = localStorage.getItem('adminKey');
      if (savedAdminKey) {
        adminKey = savedAdminKey;
        adminKeyInput.value = savedAdminKey;
        fetchDashboardStats();
        fetchServerMetrics();
        fetchRecentGames();
      }
      
      refreshServerStatus.addEventListener('click', () => {
        fetchDashboardStats();
        fetchServerMetrics();
      });
      
      refreshGames.addEventListener('click', () => {
        fetchGames(currentGamesPage);
      });
      
      refreshLogs.addEventListener('click', () => {
        // TODO: Implement logs fetching nigger :D
      });
      
      userSearch.addEventListener('input', debounce(() => {
        const searchTerm = userSearch.value.trim();
        fetchUsers(1, searchTerm);
      }, 500));
      
      addSkinForm.addEventListener('submit', (e) => {
        e.preventDefault();
        addSkin();
      });
      
      skinImageUrl.addEventListener('input', () => {
        const url = skinImageUrl.value.trim();
        if (url) {
          skinPreviewImage.src = url;
          skinPreviewContainer.style.display = 'block';
        } else {
          skinPreviewContainer.style.display = 'none';
        }
      });
      
      editSkinImageUrl.addEventListener('input', () => {
        const url = editSkinImageUrl.value.trim();
        if (url) {
          editSkinPreviewImage.src = url;
          editSkinPreviewContainer.style.display = 'block';
        } else {
          editSkinPreviewContainer.style.display = 'none';
        }
      });
      
      saveEditSkin.addEventListener('click', () => {
        editSkin();
      });
      
      closeEditSkinModal.addEventListener('click', () => {
        editSkinModal.classList.remove('active');
      });
      
      cancelEditSkin.addEventListener('click', () => {
        editSkinModal.classList.remove('active');
      });
      
      giveSkinsForm.addEventListener('submit', (e) => {
        e.preventDefault();
        giveSkinsToUser();
      });
      
      closeUserGiveSkinsModal.addEventListener('click', () => {
        userGiveSkinsModal.classList.remove('active');
      });
      
      cancelUserGiveSkins.addEventListener('click', () => {
        userGiveSkinsModal.classList.remove('active');
      });
      
      confirmUserGiveSkins.addEventListener('click', () => {
        giveSkinsToCurrentUser();
      });
      
      addSkinsToUser.addEventListener('click', () => {
        if (currentViewingUserId) {
          const username = userDetailName.textContent;
          openGiveSkinsModal(currentViewingUserId, username);
        }
      });
      
      clearUserNotifications.addEventListener('click', () => {
        clearUserNotificationsAction();
      });
      
      backToUsers.addEventListener('click', () => {
        showPage('users');
      });
      
      addSkinBtn.addEventListener('click', () => {
        showPage('add-skins');
      });
      
      closeGameDetailsModal.addEventListener('click', () => {
        gameDetailsModal.classList.remove('active');
      });
      
      closeGameDetailBtn.addEventListener('click', () => {
        gameDetailsModal.classList.remove('active');
      });
      
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          const tabContainer = tab.closest('.tabs');
          
          tabContainer.querySelectorAll('.tab').forEach(t => {
            t.classList.remove('active');
          });
          
          tab.classList.add('active');
          
          const contentSelector = tab.hasAttribute('data-modal-tab') ? '[data-modal-tab-content]' : '[data-tab-content]';
          const contentAttr = tab.hasAttribute('data-modal-tab') ? 'data-modal-tab-content' : 'data-tab-content';
          
          document.querySelectorAll(contentSelector).forEach(content => {
            content.classList.remove('active');
          });
          
          const content = document.querySelector(`[${contentAttr}="${tabName}"]`);
          if (content) {
            content.classList.add('active');
          }
        });
      });
      
      document.querySelectorAll('[data-skin-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-skin-tab');
          
          document.querySelectorAll('[data-skin-tab]').forEach(t => {
            t.classList.remove('active');
          });
          
          tab.classList.add('active');
          
          document.querySelectorAll('[data-skin-tab-content]').forEach(content => {
            content.classList.remove('active');
          });
          
          const content = document.querySelector(`[data-skin-tab-content="${tabName}"]`);
          if (content) {
            content.classList.add('active');
          }
        });
      });
      
      showPage('dashboard');
    });
    
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
  </script>
</body>
</html>